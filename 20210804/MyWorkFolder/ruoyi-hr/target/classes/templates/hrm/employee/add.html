<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('新增员工统计')" />
    <th:block th:include="include :: datetimepicker-css" />
    <th:block th:include="include :: bootstrap-fileinput-css" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-employee-add">
        	
            <input name="employeeId" type="hidden">
            <div class="form-group">
                 <label class="col-sm-3 control-label">照片</label>
	             <div class="col-sm-8">
					 <input class="fileinput-photo" type="file" name="file">
					 <input type="hidden" class="form-control" name="photo">
				</div>
            </div>
            <!-- <div class="form-group">
        		<label class="col-sm-3 control-label"></label>
        		<button class="import-ding">从钉钉导入个人信息</button>
        	</div> -->
            <div class="form-group">    
                <label class="col-sm-3 control-label is-required">员工姓名：</label>
                <div class="col-sm-8">
                    <input name="employeeName" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label ">钉钉ID：</label>
                <div class="col-sm-6">
                    <input name="userId" class="form-control" type="text">
                </div>
                <div class="col-sm-2">
                	<button id="getInfo">从钉钉导入</button>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label ">用户名：</label>
                <div class="col-sm-8">
                    <input name="loginName" class="form-control" type="text">
                </div>
            </div>
            <!-- <div class="form-group">    
                <label class="col-sm-3 control-label">员工性别：</label>
                <div class="col-sm-8">
                    <input name="gender" class="form-control" type="text">
                </div>
            </div> -->
            <div class="form-group">    
                <label class="col-sm-3 control-label ">员工性别：</label>
                <div class="col-sm-8">
                	<select name="gender" class="form-control m-b" th:with="type=${@dict.getType('hrm_employee_gender')}" required>
                		<option class="hidden"></option>
                		<option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                	</select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工生日：</label>
                <div class="col-sm-8">
                    <div class="input-group date">
                        <input name="birthday" class="form-control" placeholder="yyyy-MM-dd" type="text">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                    </div>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">籍贯：</label>
                <div class="col-sm-8">
                    <input name="comeFrom" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">民族：</label>
                <div class="col-sm-8">
                    <input name="nationality" class="form-control" type="text">
                </div>
            </div>
            <!-- <div class="form-group">    
                <label class="col-sm-3 control-label">婚姻状况：</label>
                <div class="col-sm-8">
                    <input name="marriage" class="form-control" type="text">
                </div>
            </div> -->
            <div class="form-group">    
                <label class="col-sm-3 control-label ">婚姻状况：</label>
                <div class="col-sm-8">
                	<select name="marriage" class="form-control m-b" th:with="type=${@dict.getType('hrm_marriage_status')}">
                		<option class="hidden"></option>
                		<option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                	</select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">政治面貌：</label>
                <!-- <div class="col-sm-8">
                    <div class="radio-box">
                        <input type="radio" name="politicalStatus" value="">
                        <label th:for="politicalStatus" th:text="未知"></label>
                    </div>
                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i> 代码生成请选择字典属性</span>
                </div> -->
                <div class="col-sm-8">
                	<select name="politicalStatus" class="form-control m-b" th:with="type=${@dict.getType('hrm_political_status')}">
                		<option class="hidden"></option>
                		<option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                	</select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">身份证号：</label>
                <div class="col-sm-8">
                    <input name="idCardNumber" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">健康状况：</label>
                <!-- <div class="col-sm-8">
                    <div class="radio-box">
                        <input type="radio" name="healthStatus" value="">
                        <label th:for="healthStatus" th:text="未知"></label>
                    </div>
                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i> 代码生成请选择字典属性</span>
                </div> -->
                <div class="col-sm-8">
                    <input name="healthStatus" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">参加工作时间：</label>
                <div class="col-sm-8">
                    <div class="input-group date">
                        <input name="dateStartWorking" class="form-control" placeholder="yyyy-MM-dd" type="text">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                    </div>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">工作年限：</label>
                <div class="col-sm-8">
                    <input name="timeWorked" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">学历：</label>
                <div class="col-sm-8">
                    <input name="degree" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">毕业院校：</label>
                <div class="col-sm-8">
                    <input name="university" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">专业：</label>
                <div class="col-sm-8">
                    <input name="major" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">毕业时间：</label>
                <div class="col-sm-8">
                    <div class="input-group date">
                        <input name="graduateTime" class="form-control" placeholder="yyyy-MM-dd" type="text">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                    </div>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">掌握外语：</label>
                <div class="col-sm-8">
                    <input name="foreignLanguage" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">外语等级：</label>
                <div class="col-sm-8">
                    <input name="foreignLanguageLevel" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">计算机操作：</label>
                <div class="col-sm-8">
                    <input name="computerSkill" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">计算机操作等级：</label>
                <div class="col-sm-8">
                    <input name="computerSkillLevel" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工职级：</label>
                <div class="col-sm-8">
                    <input name="employeeRank" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工等级：</label>
                <div class="col-sm-8">
                    <input name="employeeLevel" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工证书：</label>
                <div class="col-sm-8">
                    <input name="certificate" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">
                 <label class="col-sm-3 control-label">员工合同上传</label>
	             <div class="col-sm-8">
					 <input id="fileinput-contract" type="file" name="file" multiple>
					 <input type="hidden" name="contract">
					 <small><p></p></small>
				</div>
            </div>
            <!-- <div class="form-group">    
                <label class="col-sm-3 control-label">教育简历：</label>
                <div class="col-sm-8">
                    <input name="resume" class="form-control" type="text">
                </div>
            </div> class  =  file-loading -->
            <div class="form-group">
                 <label class="col-sm-3 control-label">教育简历上传</label>
	             <div class="col-sm-8">
					 <input id="fileinput-resume" type="file" name="file" multiple>
					 <input type="hidden" name="resume">
					 <small><p></p></small>
				</div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">特长爱好：</label>
                <div class="col-sm-8">
                    <input name="favorite" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">电子邮件：</label>
                <div class="col-sm-8">
                    <input name="emailAddress" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">联系地址：</label>
                <div class="col-sm-8">
                    <input name="employeeAddress" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">联系电话：</label>
                <div class="col-sm-8">
                    <input name="phoneNumber" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">邮政编码：</label>
                <div class="col-sm-8">
                    <input name="zipCode" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">身高：</label>
                <div class="col-sm-8">
                    <input name="height" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">体重：</label>
                <div class="col-sm-8">
                    <input name="weight" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">血型：</label>
                <!-- <div class="col-sm-8">
                    <select name="bloodType" class="form-control m-b">
                        <option value="">所有</option>
                    </select>
                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i> 代码生成请选择字典属性</span>
                </div> -->
                <div class="col-sm-8">
                	<select name="bloodType" class="form-control m-b" th:with="type=${@dict.getType('hrm_blood_type')}">
                		<option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                	</select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">对工作要求：</label>
                <div class="col-sm-8">
                    <input name="employeeOrder" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">入职日期：</label>
                <div class="col-sm-8">
                    <div class="input-group date">
                        <input name="dateEnrolled" class="form-control" placeholder="yyyy-MM-dd" type="text">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                    </div>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工部门：</label>
                <div class="col-sm-8">
                    <input name="employeeDepartment" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工岗位：</label>
                <div class="col-sm-8">
                    <input name="employeePost" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工工种：</label>
                <!-- <div class="col-sm-8">
                    <select name="employeeType" class="form-control m-b">
                        <option value="">所有</option>
                    </select>
                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i> 代码生成请选择字典属性</span>
                </div> -->
                <div class="col-sm-8">
                	<select name="employeeType" class="form-control m-b" th:with="type=${@dict.getType('hrm_employee_type')}">
                		<option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                	</select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工职务：</label>
                <div class="col-sm-8">
                    <input name="employeeJob" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工职称：</label>
                <div class="col-sm-8">
                    <input name="employeeTitle" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">员工状态：</label>
                <!-- <div class="col-sm-8">
                    <div class="radio-box">
                        <input type="radio" name="employeeStatus" value="">
                        <label th:for="employeeStatus" th:text="未知"></label>
                    </div>
                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i> 代码生成请选择字典属性</span>
                </div> -->
                <div class="col-sm-8">
                	<select name="employeeStatus" class="form-control m-b" th:with="type=${@dict.getType('hrm_employee_status')}">
                		<option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                	</select>
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">基础工资：</label>
                <div class="col-sm-8">
                    <input name="baseSalary" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">工资卡开户银行：</label>
                <div class="col-sm-8">
                    <input name="wageCardBank" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">工资卡账户：</label>
                <div class="col-sm-8">
                    <input name="wageCardNumber" class="form-control" type="text">
                </div>
            </div>
            
            <div class="form-group">    
                <label class="col-sm-3 control-label">其他关系：</label>
                <div class="col-sm-8">
                    <input name="otherRelationship" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">学习经历：</label>
                <div class="col-sm-8">
                    <input name="studyExperience" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">工作经历：</label>
                <div class="col-sm-8">
                    <input name="workingExperience" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">    
                <label class="col-sm-3 control-label">附件：</label>
                <div class="col-sm-8">
                    <input name="attachment" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">备注：</label>
                <div class="col-sm-8">
                    <textarea name="remark" class="form-control"></textarea>
                </div>
            </div>
        </form>
    </div>
    <th:block th:include="include :: footer" />
    <th:block th:include="include :: datetimepicker-js" />
    <th:block th:include="include :: bootstrap-fileinput-js" />
    <script th:src="@{/ruoyi/js/attachment.js}"></script>
    <script th:inline="javascript">
    	$("#getInfo").css("height",34).css("background","#299").css("border","0px").css("color","white").css("font-size",15).css("border-radius","3px");
        var prefix = ctx + "hrm/employee"
        var employeeId = "[[${employeeId}]]"
        $.file.initAddFiles("fileinput-resume")
        $.file.initAddFiles("fileinput-contract")
        $("#form-employee-add").validate({
            focusCleanup: true
        });

        function submitHandler() {
            if ($.validate.form()) {
            	$("input[name=employeeId]").val([[${employeeId}]])
            	if($("#fileinput-resume").val!==""){
            		id = $("input[name=employeeId]").val();
            		$.file.uploadFile("fileinput-resume","hrm_resume",id)
            	}
            	if($("#fileinput-contract").val!==""){
            		id = $("input[name=employeeId]").val();
            		$.file.uploadFile("fileinput-contract","hrm_contract",id)
            	}
            	if($(".fileinput-photo").val!==""){
            		id = $("input[name=employeeId]").val();
            		$(".fileinput-photo").fileinput("upload")
            	}
                $.operate.save(prefix + "/add", $('#form-employee-add').serialize());
            }
        }

        $("input[name='birthday']").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true
        });

        $("input[name='dateStartWorking']").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true
        });

        $("input[name='graduateTime']").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true
        });

        $("input[name='dateEnrolled']").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true
        });
        
        $(".fileinput-photo").fileinput({
        	theme:"explorer-fas",
        	uploadUrl:prefix+'/uploadAvatar/[[${employeeId}]]',
        	overwriteInitial:true,
        	allowedFileTypes:null,
        	showPreview:true,
            showRemove:false,
            showCaption:false,
            showUpload:false,
            initialPreview:"<center>请上传照片</center>"
        });
        
        $(".fileinput-photo").on("fileuploaded", function(event, data, proviewId, index) {
        	
        	$("input[name=photo]").val(data.files[0].name)
        	$(".kv-upload-progress").hide()
        	//alert("上传成功")
        	/* console.log(data.files[0].name);
            console.info(event);
            console.info(data);
            console.info(proviewId);
            console.info(index); */
        });
        
        
        /* $(".fileinput-resume").fileinput({
        	theme: "explorer-fas",
            uploadUrl: prefix+'/uploadResume/[[${employeeId}]]',
            overwriteInitial:true,
            showPreview:false,
            showRemove:false,
            showCaption:true,
            showUpload:false,
            allowedFileTypes:null
        });
        
        $(".fileinput-resume").on("fileuploaded", function(event, data, proviewId, index) {
        	
        	$("input[name=resume]").val(data.files[0].name)
        	$(".kv-upload-progress").hide()
        	//alert("上传成功")
        	$("p").empty();
        	$("p").append(data.files[0].name);
        	console.log(data.files[0].name);
            console.info(event);
            console.info(data);
            console.info(proviewId);
            console.info(index);
        }); */
        $("#getInfo").click(function(){
        	 /* $.each($("option"),function(){
        		console.log($(this).val())
        	})   */
        	
        	var id = $("input[name=userId]").val()
        	if(id !== ''){
        		var config={
        				url:prefix+"/getInfo",
        				type:"post",
        				dataType:"json",
        				data:$("#form-employee-add").serialize(),
        				success:function(data){
        					//console.log("success"+data.msg)
        					//console.log(data.mirrage)
        					if(data.msg=="钉钉id已存在"){
        						
        						$.modal.alertError(data.msg)
        					}
        					$("input[name=employeeName]").val(data.employeeName)
        					$("input[name=employeePost]").val(data.employeePost)
        					$("input[name=employeeDepartment]").val(data.employeeDepartment)
        					$("input[name=phoneNumber]").val(data.phoneNumber)
        					$("input[name=birthDate]").val(data.birthDate)
        					$("input[name=idCardNumber]").val(data.idCardNumber)
        					$("input[name=employeeStatus]").val(data.employeeStatus)
        					
        					$("option[value="+data.mirrage+"]").attr("selected","selected")
        					$("option[value="+data.employeeStatus+"]").attr("selected","selected")
        					$("option[value="+data.employeeType+"]").attr("selected","selected")
        					$("option[value="+data.gender+"]").attr("selected","selected")
        					
        					$("input[name=wageCardBank]").val(data.wageCardBank)
        					$("input[name=wageCardNumber]").val(data.wageCardNumber)
        					$("input[name=employeeAddress]").val(data.employeeAddress)
        					$("input[name=dateStartWorking]").val(data.dateStartWorking)
        					$("input[name=emailAddress]").val(data.emailAddress)
        					$("input[name=university]").val(data.university)
        					$("input[name=dateEnrolled]").val(data.dateEnrolled)
        					/* console.log($("option[value=married]").val())
        					console.log($("body").html()) */
        					$("input[name=nationality]").val(data.nationality)
        					$("input[name=major]").val(data.major)
        					$("input[name=graduateTime]").val(data.graduateTime)
        				}
        				
        				
        		}
        		$.ajax(config)
        	}
        	else{
        		$.modal.alertError("需要先输入钉钉ID才可以导入")
        	}
        })
        /* $(".file-preview:eq(1)").hide() */
        //$("button").css("height",34).css("background","#299").css("border","0px").css("color","white").css("font-size",15).css("border-radius","3px");
    </script>
</body>
</html>